---
title: 'Introduction to R: Homework 3 - Key'
output:
  html_document: default
---

### **Instructions**



Homework is optional, but we recommend it so you can get the most out of this course.

```{r initiatePackages, message=FALSE}
## you can add more, or change...these are suggestions
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
```


### **Problem Set**

1\. Bring the following dataset into R. 

-  The dataset is located at: https://daseh.org/data/Baltimore_surface_water_quality_data.csv. 
-  You can use the link, download it, or use whatever method you like for getting the file. 
-  Once you get the file, read the dataset in using `read_csv()` and assign it the name "water".

```{r 1response}
water <- read_csv("https://daseh.org/data/Baltimore_surface_water_quality_data.csv")
```


2\. Run the `colnames()` function to take a look at the dataset column names. Rename the third column of "water" to "GPS_North" using the `rename()` function in `dplyr`. Then rename the fourth column to "GPS_West".  

```{r 2response}
colnames(water)
water <- water |> rename(GPS_North = `GPS Coordinate North`)
water <- water |> rename(GPS_West = `GPS Coordinate West`)
```


3\. Convert the "datetime" column to POSIXct format using the `mdy_hm()` functions from the `lubridate` package. Then create the variables "Month" and "Year" by extracting the month and year from the `datetime` column. (HINT: use mutate and `year(datetime_fixed)` to create your new variables.)


```{r 3response}
#converting the date format to POSIXct
water <- water |> mutate(datetime_fixed = mdy_hm(datetime))

#creating new variables
water <- water |> mutate(Year = year(datetime_fixed))
water <- water |> mutate(Month = month(datetime_fixed))

```

4\. Separate `datetime_fixed` into two separate columns: "date" and "time" using the `separate()` function. Replace the original "water" object by calling the new dataset "water".

```{r 4response}
water <- water |> separate(`datetime_fixed`, into = c("date", "time"), sep = " ")
```

5\. What is the class for "Result"? Can you take the mean value? Why or why not? What can you do to change the format of "Result" to numeric? 

```{r 5response}
water |> pull(Result) |> class()

# "Result" is of type "character". For some tests, the result is listed as below the detectable level, using a ">". R can only interpret this symbol as a character. In order to change "Result" to numeric, we need to change the values of the results that are below detectable levels. Some options are to change these to 0 or to NA. You can also change them on a case-by-case basis to a number just slightly smaller than the detectable level (for example, if the level is 3 ug, anything below this could be coded as 2.9 ug). Use your best judgment on how to recode these values.

```

6\. Replace the below detectable level values in "Results" with a measure that you choose. You should use a combination of `str_replace`,  `pull()` (because stringr package functions work on vectors not dataframes!) and `mutate()`. Replace the original "water" object by calling the new dataset "water".

-  The `pattern =` to find the starting parenthesis is "^<"
-  The `replacement =` depends on how you choose to replace the values

```{r 6response}
#replacing values with NA
water <- water |> mutate(Result = str_replace(pull(water, Result), pattern = "^<", replacement = NA_character_))

#replacing values with 0
#water <- water |> mutate(Result = str_replace(pull(water, Result), pattern = "^<", replacement = 0))
```

7\. Use `as.numeric()` to convert "Result" to numeric class. Then convert "Parameter" to a factor with `as.factor`.

```{r 7response}
water <- water |>
  mutate(Result = as.numeric(Result)) 
water <- water |> 
  mutate(Parameter = as.factor(Parameter))
```

8\. How many different measurements (levels) are stored in the Parameter column?

```{r 8response}
water |> pull(Parameter) |> levels()

#There are 49 different types of measurements in this dataset.
```

9\. Use the `pct_complete()` function in the `naniar` package to determine the percent missing data in "Results". You might need to load and install `naniar`!

```{r 9response}
library(naniar)
pct_complete(water)
# "water" is 99.99913 percent complete if you chose to replace results below the detectable limit with 0. The dataset is 99.47796 if you instead chose to replace results below the detectable limit with NA.
```

10\. Are there any parameter levels that have a complete record in "water" across all years? **Hint:** Create a new dataframe using `group_by` and `summarize` to count the number of NAs in "Result" for each level in "Parameter", then filter out rows with more than 0.

```{r 10response}
na_counts <- water %>%
  group_by(Parameter) %>%
  summarise(na_count = sum(is.na(Result)))

na_counts |> filter(na_count == 0)

#If you replaced the values below detectable levels with NA, there are seven parameter levels (tests) that have no missing data. If you replaced the values below detectable levels with 0, all the parameter levels (tests) have complete data.
```

11\. Subset "water"  so that it only contains results for the years 2010 - 2024, using `&` and the filter function. Make sure to include both the years 2010 and 2024. Confirm your filtering worked by looking at the range of "Year". Assign this subsetted tibble to "water_subset".

```{r 11response}
water_subset <- water |> filter(Year >= 2010 & Year <= 2024)
water_subset |>
  pull(Year) |>
  range() # confirm it worked
```


12\. Subset "water_subset"  so that it only contains results from the tests for dissolved oxygen, pH, and water temperature, using %in% and the filter function. Make sure to reassign to "water_subset".

```{r 12response}
water_subset <- water_subset |>
  filter(Parameter %in% c("Dissolved Oxygen", "pH", "Water Temperature"))
```


13\. Load the new dataset "Baltimore_rainfall_HamiltonAve.csv" into R.  

-  The dataset is located at: https://daseh.org/data/Baltimore_rainfall_HamiltonAve.csv. 
-  You can use the link, download it, or use whatever method you like for getting the file. 
-  Once you get the file, read the dataset in using `read_csv()` and assign it the name "rainfall".

This dataset contains measured precipitation by month, as collected near the Hamilton Ave testing location in Baltimore.

```{r 13response}
rainfall <- read_csv("https://daseh.org/data/Baltimore_rainfall_HamiltonAve.csv")
```

14\. We want only the rainfall measurements for the years 2010 - 2024 from this new dataset, as well as the month information. Subset the dataset using the `select()` function. Reassign this to `rainfall`. HINT: Make sure you remember to keep the column that contains information about the month!

```{r 14response}
rainfall <- rainfall |> select(c("Month", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024"))
```


15\. Reshape `rainfall` into long format using `pivot.longer`. The reshaped dataset should contain three columns: year ("Year"), month ("Month"), and amount of rainfall ("Precip"). ou should pivot all columns except "Month". **Hint:** listing `!COLUMN` or `-COLUMN` means everything except COLUMN. Assign the reshaped dataset to `rainfall_long`.

```{r 15response}
rainfall_long <- rainfall |> pivot_longer(!Month, names_to = "Year", values_to = "Precip")
```

16\. We would like to join the rainfall measurements dataset with the Baltimore surface water quality dataset, but we need to do a bit more wrangling first. Because the rainfall measures were collected near the Hamilton Ave water testing site, let's pull only the Hamilton Ave data from the `water_subset` data, using `filter`. Assign this to `water_Ham`.

```{r 16response}
water_Ham <- water_subset |> filter(Station == "HAMILTON AVE.")
```

