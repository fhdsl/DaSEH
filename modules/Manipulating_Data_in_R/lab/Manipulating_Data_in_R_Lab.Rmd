---
title: "Manipulating Data in R Lab"
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Data in this lab comes from the OCS "Exploring CO2 emissions across time" activity (https://www.opencasestudies.org/ocs-bp-co2-emissions/) and the CO Department of Health (https://coepht.colorado.gov/heat-related-illness). Both datasets are available in the `dasehr` package.

```{r message=FALSE}
library(readr)
library(dplyr)
library(tidyr)
library(dasehr)
```

# Part 1

### 1.1

Open the `yearly_co2_emissions` dataset from the `dasehr` package and assign it to an object called `co2`. (You can also use `read_csv()` from the `readr` package and download the dataset directly from the daseh.org website: "https://daseh.org/data/Yearly_CO2_Emissions_1000_tonnes.csv")

-  Remember to use `read_csv()` from the `readr` package.
-  Do NOT use `read.csv()`.

```{r 1.1response}

```

### 1.2

Look at the column names using `colnames` - do you notice any patterns?

```{r 1.2response}

```

### 1.3

Let's rename the column "2011" in "co2" to "CO2_2011" using `rename`. Repeat this for the years 2012, 2013, and 2014. Make sure to reassign to `vacc` here and in subsequent steps.

```
# General format
new_data <- old_data %>% rename(newname = oldname)
```

```{r 1.3response}

```

### 1.4

Select only the columns "country", and those that start with "CO2_". Use `select` and `starts_with("CO2_")`.

```
# General format
new_data <- old_data %>% select(colname1, colname2, ...)
```

```{r 1.4response}

```

### 1.5

Create a new dataset "co2_long" that does `pivot_longer()` on all columns except "country". Remember that `!country` means all columns except "country".

```
# General format
new_data <- old_data %>% pivot_longer(cols = colname(s))
```

```{r 1.5response}

```

### 1.6

Using `co2_long`, filter the "country" column so it only includes values from the United States. **Hint**: use `filter` and `%>%`.

```
# General format
new_data <- old_data %>% filter(colname %>% "name")
```

```{r 1.6response}

```

### 1.7

Use `pivot_wider` to reshape "co2_long". Use "name" for the `names_from` argument. Use "value" for the `values_from` argument. Call this new data `co2_wide`. Look at the data. How do these years compare to one another.

```
# General format
new_data <- old_data %>% pivot_wider(names_from = column1, values_from = column2)
```

```{r 1.7response}

```


# Practice on Your Own!

### P.1

Take the code from Questions 1.1 and 1.3-1.7. Chain all of this code together using the pipe ` %>% `. Call your data `co2_compare`.

```{r P.1response}

```

### P.2

Modify the code from Question P.1:

-  Choose 4 different years to examine 
-  Select different country to compare
-  Call your data `co2_compare2`

```{r P.2response}

```


# Part 2

### 2.1

Open the `CO_heat_ER_bygender` dataset from the `dasehr` package and assign it to the name `CO_heat`, selecting only the "county", "visits", "year", and "gender" columns using `%>% filter()`


```{r 2.1response}

```

### 2.2

Use `pivot_wider` to reshape "CO_heat". Use "county" for the `names_from` argument. Use "visits" for the `values_from` argument. Reassign this data to "CO_heat".

```
# General format
new_data <- old_data %>% pivot_wider(names_from = column1, values_from = column2)
```

```{r 2.2response}

```

### 2.3

Join the data. Keep only data that is found in both "co2_long" and "CO_heat". Before you do this, you will need to rename the years in "co2_long" from "CO2_2011" to "2011", etc using  `mutate` and `recode`.

```
# General format
new_data <- old_data %>% mutate(column_name = recode(column_name, old_value1 = 'new_value1', old_value2 = 'new_value2'))
```

Once you've renamed your values, join the data in two ways:

- First, try joining without using the `by` argument - what happens? 
- Next, try joining using `by = c("year" = "name")`. 
- Call the output "merged". How many observations (rows) are there?

```
# General format
new_data <- inner_join(x, y, by = c("colname1" = "colname2"))
```

```{r 2.3response}

```

Wait, why did neither merge work? It turns out the class of the columns we are merging by need to be the same, so we need to change `name` in `co2_long` to class `double` in order to merge it with `CO_heat`. We can do this using `mutate` and `as.double`.

```
# General format
new_data <- old_data %>% mutate(column_name = as.double(column_name))
```


```{r 2.3responsePt2}

```

### 2.4

Change your code from Question 2.3 to do a `full_join.` Call the output "full". How many observations (rows) are there?

```
# General format
new_data <- full_join(x, y, by = c("colname1" = "colname2"))
```

```{r 2.4response}

```


# Practice on Your Own!

### P.3

Do a left join of "CO_heat" and "co2_long". Call the output "left". How many observations are there?

```{r P.3response}

```

### P.4

Copy your code from Question P.3 and change it to a `right_join` with the same order of the arguments. Call the output "right". How many observations are there?

```{r P.4response}

```

### P.5

Perform two `anti_join` operations on "CO_heat" and "co2_long" to determine what years are missing from the `CO_heat` data and which are missing from the `co2_long` data.

```
# General format
anti_join(L, R, by = c("name_L" = "name_R")) %>% select(name_L)
```

```{r P.5response}

```
