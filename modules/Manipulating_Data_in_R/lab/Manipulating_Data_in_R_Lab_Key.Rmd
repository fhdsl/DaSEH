---
title: "Manipulating Data in R Lab - Key"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Data in this lab comes from the OCS "Exploring CO2 emissions across time" activity (https://www.opencasestudies.org/ocs-bp-co2-emissions/) and the CO Department of Health (https://coepht.colorado.gov/heat-related-illness). Both datasets are available in the `dasehr` package.

```{r message=FALSE}
library(readr)
library(dplyr)
library(tidyr)
library(dasehr)
```

# Part 1

### 1.1

Open the `yearly_co2_emissions` dataset from the `dasehr` package and assign it to an object called `co2`. (You can also use `read_csv()` from the `readr` package and download the dataset directly from the daseh.org website: "https://daseh.org/data/Yearly_CO2_Emissions_1000_tonnes.csv")

-  Remember to use `read_csv()` from the `readr` package.
-  Do NOT use `read.csv()`.

```{r 1.1response}
co2 <- yearly_co2_emissions

co2 <- read_csv("https://daseh.org/data/Yearly_CO2_Emissions_1000_tonnes.csv")
```

### 1.2

Look at the column names using `colnames` - do you notice any patterns?

```{r 1.2response}
colnames(co2)
# Most column names are years, so we will have to be careful when calling them using tidyverse tools!
```

### 1.3

Let's rename the column "2011" in "co2" to "CO2_2011" using `rename`. Repeat this for the years 2012, 2013, and 2014. Make sure to reassign to `vacc` here and in subsequent steps.

```
# General format
new_data <- old_data %>% rename(newname = oldname)
```

```{r 1.3response}
co2 <- co2 %>% rename(CO2_2011 = `2011`)
co2 <- co2 %>% rename(CO2_2012 = `2012`)
co2 <- co2 %>% rename(CO2_2013 = `2013`)
co2 <- co2 %>% rename(CO2_2014 = `2014`)
```

### 1.4

Select only the columns "country", and those that start with "CO2_". Use `select` and `starts_with("CO2_")`.

```
# General format
new_data <- old_data %>% select(colname1, colname2, ...)
```

```{r 1.4response}
co2 <- co2 %>% select(country, starts_with("CO2_"))

```

### 1.5

Create a new dataset "co2_long" that does `pivot_longer()` on all columns except "country". Remember that `!country` means all columns except "country".

```
# General format
new_data <- old_data %>% pivot_longer(cols = colname(s))
```

```{r 1.5response}
co2_long <- co2 %>% pivot_longer(cols = !country)
```

### 1.6

Using `vacc_long`, filter the "country" column so it only includes values from the United States. **Hint**: use `filter` and `%in%`.

```
# General format
new_data <- old_data %>% filter(colname %>% "name")
```

```{r 1.6response}
co2_long <- co2_long %>%
  filter(country %in% "United States")
```

### 1.7

Use `pivot_wider` to reshape "co2_long". Use "name" for the `names_from` argument. Use "value" for the `values_from` argument. Call this new data `co2_wide`. Look at the data. How do these states compare to one another.

```
# General format
new_data <- old_data %>% pivot_wider(names_from = column1, values_from = column2)
```

```{r 1.7response}
co2_wide <- co2_long %>%
  pivot_wider(
    names_from = name,
    values_from = value
  )
co2_wide
```


# Practice on Your Own!

### P.1

Take the code from Questions 1.1 and 1.3-1.7. Chain all of this code together using the pipe ` %>% `. Call your data `co2_compare`.

```{r P.1response}
co2_compare <-
  co2 <- yearly_co2_emissions %>%
  rename(CO2_2011 = `2011`) %>%
  rename(CO2_2012 = `2012`) %>%
  rename(CO2_2013 = `2013`) %>%
  rename(CO2_2014 = `2014`) %>%
  select(country, starts_with("CO2_")) %>%
  pivot_longer(cols = !country) %>%
  filter(country %in% "United States") %>%
  pivot_wider(names_from = name, values_from = value)

co2_compare
```

### P.2

Modify the code from Question P.1:

-  Choose 4 different years to examine 
-  Select different country to compare
-  Call your data `co2_compare2`

```{r P.2response}
co2_compare2 <-
  co2 <- yearly_co2_emissions %>%
  rename(CO2_2011 = `2011`) %>%
  rename(CO2_2012 = `2012`) %>%
  rename(CO2_2013 = `2013`) %>%
  rename(CO2_2014 = `2014`) %>%
  select(country, starts_with("CO2_")) %>%
  pivot_longer(cols = !country) %>%
  filter(country %in% "United States") %>%
  pivot_wider(names_from = name, values_from = value)

co2_compare2
```


# Part 2

### 2.1

Open the `CO_heat_ER_bygender` dataset from the `dasehr` package and assign it to the name `CO_heat`, selecting only the "county", "visits", "year", and "gender" columns using `%>% filter()`


```{r 2.1response}
CO_heat <- CO_heat_ER_bygender %>% select(c("county", "visits", "year", "gender"))
  
# If downloaded
# CO_heat <- read_csv("Colorado_ER_heat_visits_by_county_gender.csv")
```

### 2.2

Use `pivot_wider` to reshape "CO_heat". Use "year" for the `names_from` argument. Use "visits" for the `values_from` argument. Reassign this data to "CO_heat".

```
# General format
new_data <- old_data %>% pivot_wider(names_from = column1, values_from = column2)
```

```{r 2.2response}
CO_heat <- CO_heat %>%
  pivot_wider(
    names_from = year,
    values_from = visits
  )
```

### 2.3

Join the data. Keep only data that is found in both "vacc" and "gdp". 

- First, try joining without using the `by` argument - what happens? 
- Next, try joining using `by = c("Entity" = "GeoName")`. 
- Call the output "merged". How many observations (rows) are there?

```
# General format
new_data <- inner_join(x, y, by = c("colname1" = "colname2"))
```

```{r 2.3response}
# merged <- inner_join(vacc, gdp) does not work!
merged <- inner_join(vacc, gdp, by = c("Entity" = "GeoName"))
nrow(merged)
```

### 2.4

Change your code from Question 10 to do a `full_join.` Call the output "full". How many observations (rows) are there?

```
# General format
new_data <- full_join(x, y, by = c("colname1" = "colname2"))
```

```{r 2.4response}
full <- full_join(vacc, gdp, by = c("Entity" = "GeoName"))
nrow(full)
```


# Practice on Your Own!

### P.3

Do a left join of "vacc" and "gdp". Call the output "left". How many observations are there?

```{r P.3response}
left <- left_join(vacc, gdp, by = c("Entity" = "GeoName"))
nrow(left)
```

### P.4

Copy your code from Question P.3 and change it to a `right_join` with the same order of the arguments. Call the output "right". How many observations are there?

```{r P.4response}
right <- right_join(vacc, gdp, by = c("Entity" = "GeoName"))
nrow(right)
```

### P.5

Perform two `anti_join` operations on "vacc" and "gdp" to determine what Entities are missing from the GDP data and which are missing from the vaccine data.

```
# General format
anti_join(L, R, by = c("name_L" = "name_R")) %>% select(name_L)
```

```{r P.5response}
in_vacc_only <- anti_join(vacc, gdp, by = c("Entity" = "GeoName")) %>% select(Entity)
in_gdp_only <- anti_join(gdp, vacc, by = c("GeoName" = "Entity")) %>% select(GeoName)
in_vacc_only
in_gdp_only
```
