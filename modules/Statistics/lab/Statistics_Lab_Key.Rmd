---
title: "Statistics Lab - Key"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part 1

### 1.1

Load the libraries needed in this lab. Then, read in the CalEnviroScreen data and assign it to the "ces" variable. You can find the data at https://daseh.org/data/CalEnviroScreen_data.csv


```{r message = FALSE}
library(tidyverse)
library(broom)
```

```{r 1.1response}
ces <- read_csv("https://daseh.org/data/CalEnviroScreen_data.csv")
```

### 1.2

Compute the correlation (with `cor`) between the `PM2.5` and `Ozone` variables. (No need to save this in an object. Just display the result to the screen.) Use the `pull()` function to first extract these columns. Then, use the `cor` function.

`PM2.5`: Annual mean concentration of fine particulate matter (particulates less than 2.5 microns in diameter). Higher numbers indicate poorer air quality

`Ozone`: Average daily ozone concentration at ground level. Higher numbers indicate poorer air quality

```{r 1.2response}
x <- pull(ces, PM2.5)
y <- pull(ces, Ozone)

cor(x, y)
```

### 1.3

Compute the correlation (with `cor`) between the `DieselPM`, `Traffic`, and `Asthma` variables. (No need to save this in an object. Just display the result to the screen.) Use `select()` function to first subset the data frame to keep the four columns only. To use a column name in `select()` that starts with a number, surround it with backticks. Does this change when we use the `use = "complete.obs"` argument? 

`DieselPM`: Diesel PM emissions from on-road and non-road sources

`Traffic`: Measure of traffic density within 150 meters of the census tract boundary

`Asthma`: Age-adjusted rate of emergency department visits for asthma

```{r 1.3response}
ces_sub <-
  ces %>%
  select(DieselPM, Traffic, Asthma)

cor(ces_sub)
cor(ces_sub, use = "complete.obs")
```

### 1.4

Perform a t-test to determine if there is evidence of a difference between lead exposure burden (`Lead`) in Los Angeles census tracts compared to San Diego:

* Create a subset of the data for CaliforniaCounty == "Los Angeles"
* Create a subset of the data for CaliforniaCounty == "San Diego"
* `pull` the `Lead` column for both subsets
* Use `t.test` to compare the two pulled vectors
* Print the results using the `tidy` function from the `broom` package

`Lead`: Estimated risk for lead exposure in children living in low-income communities with older housing

```{r 1.4response}
losangeles <- ces %>% filter(CaliforniaCounty == "Los Angeles")
sandiego <- ces %>% filter(CaliforniaCounty == "San Diego")

x <- pull(losangeles, Lead)
y <- pull(sandiego, Lead)

t.test(x, y)
tidy(t.test(x, y))

# Another way to look at it..
ces %>% 
  group_by(CaliforniaCounty) %>% 
  summarize(mean = mean(Lead, na.rm = TRUE)) %>% 
  filter(CaliforniaCounty %in% c("Los Angeles", "San Diego"))
```


# Practice on Your Own!

### P.1

Perform a t-test similar to 1.4, but this time examine differences in `HousingBurden`. 

`HousingBurden`: Percentage of housing-burdened low-income households. Households are considered cost-burdened when they spend more than 30% of their income on rent, mortgage payments, and other housing costs

```{r P.1response}
x <- pull(losangeles, HousingBurden)
y <- pull(sandiego, HousingBurden)

t.test(x, y)
tidy(t.test(x, y))
```

### P.2 

Filter `ces` so it only contains Los Angeles and San Diego. Launch Esquisse or create a ggplot which plots:

* `Lead` exposure on the x axis
* `HousingBurden` on the y axis
* Colors points (`geom_point()`) by `CaliforniaCounty`

```{r P.2response}
ces_sub <- 
  ces %>% 
  filter(CaliforniaCounty %in% c("Los Angeles", "San Diego"))

ggplot(ces_sub, aes(x = Lead, y = HousingBurden, color = CaliforniaCounty)) +
  geom_point()
```


# Part 2

### 2.1

Fit a linear regression model with `LowBirthWeightPctl` as the outcome and `CES4.0Score` as the predictor. Save the model fit in an object called "lmfit_bw" and display the summary table with `summary()`.

`LowBirthWeight`: Percentage of newborns that are considered to have a low birthweight

`CES4.0Score`: Score that estimates the environmental health burden of living in a particular census tract. A higher score indicates a greater amount of poor environmental measures for a given area. These measures include things like pollution, exposure to lead, and chance of contaminated groundwater.

```
# General format
glm(y ~ x, data = DATASET_NAME)
```

```{r 2.1response}
lmfit_bw <- glm(LowBirthWeight ~ CES4.0Score, data = ces)
summary(lmfit_bw)
```

### 2.2

Fit a linear regression model with `LowBirthWeightPctl` as the outcome and `CES4.0Score` and `Poverty` as the predictors. Save the model fit in an object called "lmfit_bw2" and display the summary table.

`Poverty`: Percent of population living below two times the federal poverty level

```{r 2.2response}
lmfit_bw2 <- glm(LowBirthWeight ~ CES4.0Score + Poverty, data = ces)
summary(lmfit_bw2)
```


# Practice on Your Own!

### P.2

Fit a linear regression model with `LowBirthWeight` as the outcome, `CES4.0Score` and `Poverty` as the predictors, and interaction between `CES4.0Score` and `Poverty`.

- To include the interaction, use `CES4.0Score * Poverty` in the formula. 
- Save the model fit in an object called "lmfit_bw3" and display the summary table with `summary()`.

```{r P.2response}
lmfit_bw3 <- glm(LowBirthWeight ~ CES4.0Score + Poverty + CES4.0Score * Poverty, data = ces)
summary(lmfit_bw3)
```

### P.3

Fit a logistic regression model where the outcome is whether the CES percentile is above the 50th percentile and predictors are `Poverty` and `Education`, as well as the interaction between `Poverty` and `Education`. You will need to first create a variable "CESPctlMoreThan50" using the `mutate` and `case_when` commands.

Information about the CES4.0 percentile rank is stored in the `CES4.0Percentile` variable.

`CES4.0Percentile`: How the CES4.0Score for a given census tract ranks compared to all the census tracts in California. A higher score means residents particular census tract experience a greater burden of things like pollution compared to other California residents. 

`CESPctlMoreThan50`: In this question, you dividing all the census tracts into two categories: those with greater burden of pollution, and those with a smaller burden of pollution

`Poverty`: Percent of population living below two times the federal poverty level

`Education`: Percent of population over 25 with less than a high school education

- Save the model fit in an object called "logfit_ces" and display the summary table with `summary()`.

```
# General format
df <- df %>% mutate(binary_y = case_when(y > 50  ~ 1, y < 50 ~ 0)) 
glm(y ~ x, data = DATASET_NAME, family = binomial(link = "logit"))
```

```{r P.3response}
ces <- ces %>% 
  mutate(CESPctlMoreThan50 = 
           case_when(CES4.0Percentile > 50  ~ 1, CES4.0Percentile < 50 ~ 0))

logfit_ces <- glm(CESPctlMoreThan50 ~ Poverty + Education + Poverty * Education, data = ces, family = binomial(link = "logit"))
summary(logfit_ces)
```
